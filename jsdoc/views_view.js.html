<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: views/view.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: views/view.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
import $ from '$qui/lib/jquery.module.js'

import {AssertionError} from '$qui/base/errors.js'
import {Mixin}          from '$qui/base/mixwith.js'
import * as Toast       from '$qui/messages/toast.js'


/**
 * @alias qui.views.STATE_NORMAL
 */
export const STATE_NORMAL = 'normal'

/**
 * @alias qui.views.STATE_WARNING
 */
export const STATE_WARNING = 'warning'

/**
 * @alias qui.views.STATE_ERROR
 */
export const STATE_ERROR = 'error'

/**
 * @alias qui.views.STATE_PROGRESS
 */
export const STATE_PROGRESS = 'progress'


/** @lends qui.views.ViewMixin */
const ViewMixin = Mixin((superclass = Object) => {

    /**
     * A mixin to be used with classes that behave as views (have a visual HTML representation).
     * @alias qui.views.ViewMixin
     * @mixin
     */
    class ViewMixin extends superclass {

        /**
         * @constructs
         * @param {String} [cssClass] additional CSS classes to set to the view element
         * @param {...*} args parent class parameters
         */
        constructor({cssClass = null, ...args} = {}) {
            super(args)

            /* ViewMixin is prepared to be initialized multiple times along the inheritance path;
             * this may happen when inheriting ViewMixin more than once through mixins */

            if (this._html === undefined) {
                this._html = null
            }

            if (this._state === undefined) {
                this._state = STATE_NORMAL
                this._warningMessage = null
                this._errorMessage = null
                this._progressPercent = null
            }

            if (!this._cssClass) {
                this._cssClass = cssClass
            }
            else {
                this._cssClass += ` ${cssClass}`
            }
        }


        /* HTML */

        /**
         * Create the HTML element of this view.
         * @abstract
         * @returns {jQuery}
         */
        makeHTML() {
            return $('&lt;div>&lt;/div>')
        }

        /**
         * Override this to further initialize the HTML element of this view.
         * @param {jQuery} html the HTML element to be initialized
         */
        initHTML(html) {
        }

        /**
         * Return the HTML element of this view.
         * @returns {jQuery}
         */
        getHTML() {
            if (this._html == null) {
                this._html = this.makeHTML()
                this.initHTML(this._html)

                if (this._cssClass) {
                    this._html.addClass(this._cssClass)
                }

                this.init()
            }

            return this._html
        }

        /**
         * Tells if the HTML element of this view has been created.
         * @return {Boolean}
         */
        hasHTML() {
            return this._html != null
        }

        /**
         * Initialize the view. Called after the HTML has been created and initialized.
         */
        init() {
        }


        /* State */

        /**
         * Update the current state.
         * @param {String} state the desired state
         */
        setState(state) {
            /* Make sure we have the HTML created before switching states */
            this.getHTML()

            if (this._state !== state) {
                this.leaveState(this._state, state)
            }

            let oldState = this._state
            this._state = state

            this.enterState(oldState, state)
        }

        /**
         * Return the current view state.
         * @returns {String}
         */
        getState() {
            return this._state
        }

        /**
         * Define the behavior of the view when entering states. Entering a state usually means showing a visual element
         * corresponding to that state.
         * @param {String} oldState
         * @param {String} newState
         */
        enterState(oldState, newState) {
            switch (newState) {
                case STATE_NORMAL:
                    break

                case STATE_WARNING:
                    this.showWarning(this._warningMessage)
                    break

                case STATE_ERROR:
                    this.showError(this._errorMessage)
                    break

                case STATE_PROGRESS:
                    this.showProgress(this._progressPercent)
                    break
            }
        }

        /**
         * Define the behavior of the view when leaving states. Leaving a state usually means hiding a visual element
         * corresponding to that state.
         * @param {String} oldState
         * @param {String} newState
         */
        leaveState(oldState, newState) {
            switch (oldState) {
                case STATE_NORMAL:
                    break

                case STATE_WARNING:
                    this._warningMessage = null
                    this.hideWarning()
                    break

                case STATE_ERROR:
                    this._errorMessage = null
                    this.hideError()
                    break

                case STATE_PROGRESS:
                    this._progressPercent = null
                    this.hideProgress()
                    break
            }
        }


        /* Progress */

        /**
         * Put the view in the progress state or updates the progress. The view state is set to
         * {@link qui.views.STATE_PROGRESS}.
         *
         * It is safe to call this method multiple times, updating the progress percent.
         *
         * @param {?Number} [percent] optional progress percent (from `0` to `100`); `null` indicates indefinite
         * progress
         */
        setProgress(percent = null) {
            /* No duplicate setProgress() protection, since we want to be able to update the progress */

            this._progressPercent = percent
            this.setState(STATE_PROGRESS)
        }

        /**
         * Put the view in the normal state, but only if the current state is {@link qui.views.STATE_PROGRESS}.
         */
        clearProgress() {
            if (this._state === STATE_PROGRESS) {
                this.setState(STATE_NORMAL)
            }
        }

        /**
         * Return the current progress percent.
         *
         * An exception will be thrown if the current view state is not {@link qui.views.STATE_PROGRESS}.
         *
         * @returns {?Number}
         */
        getProgressPercent() {
            if (this._state !== STATE_PROGRESS) {
                throw new AssertionError(`getProgressPercent() called in ${this._state} state`)
            }

            return this._progressPercent
        }

        /**
         * Define how the view is displayed in progress state, disallowing any user interaction.
         *
         * {@link qui.views.ViewMixin#inProgress} returns `true` when called from this method.
         *
         * Does nothing by default. Override this method to implement your own progress display.
         *
         * @param {?Number} [percent] optional progress percent (from `0` to `100`); `null` indicates indefinite
         * progress
         */
        showProgress(percent) {
        }

        /**
         * Hide a previously displayed progress, re-enabling user interaction.
         *
         * {@link qui.views.ViewMixin#inProgress} returns `false` when called from this method.
         *
         * Does nothing by default. Override this method to implement your own progress hiding.
         */
        hideProgress() {
        }

        /**
         * Tell if the view is currently in progress (its state is {@link qui.views.STATE_PROGRESS}).
         * @returns {Boolean}
         */
        inProgress() {
            return this._state === STATE_PROGRESS
        }


        /* Warning */

        /**
         * Put the view in the warning state or updates the warning message. The view state is set to
         * {@link qui.views.STATE_WARNING}.
         *
         * It is safe to call this method multiple times, updating the warning message.
         *
         * @param {?String} [message] an optional warning message
         */
        setWarning(message = null) {
            /* No duplicate setWarning() protection, since we want to be able to update the error */

            this._warningMessage = message
            this.setState(STATE_WARNING)
        }

        /**
         * Put the view in the normal state, but only if the current state is {@link qui.views.STATE_WARNING}.
         */
        clearWarning() {
            if (this._state === STATE_WARNING) {
                this.setState(STATE_NORMAL)
            }
        }

        /**
         * Return the warning message set with {@link qui.views.ViewMixin#setWarning} or `null` if no warning message
         * was set.
         *
         * An exception will be thrown if the current view state is not {@link qui.views.STATE_WARNING}.
         *
         * @returns {?String}
         */
        getWarningMessage() {
            if (this._state !== STATE_WARNING) {
                throw new AssertionError(`getWarningMessage() called in ${this._state} state`)
            }

            return this._warningMessage
        }

        /**
         * Define how the view is displayed in warning state, showing the warning message.
         *
         * {@link qui.views.ViewMixin#hasWarning} returns `true` when called from this method.
         *
         * By default displays a warning toast message. Override this method to implement your own warning display.
         *
         * @param {?String} message the warning message, or `null` if no warning message available
         */
        showWarning(message) {
            Toast.show({message: message, type: 'error', timeout: 0})
        }

        /**
         * Hide a previously displayed warning.
         *
         * {@link qui.views.ViewMixin#hasWarning} returns `false` when called from this method.
         *
         * By default calls {@link qui.messages.toast.hide}. Override this method to implement your own warning
         * hiding.
         */
        hideWarning() {
            Toast.hide()
        }

        /**
         * Tell if the view is currently in the warning state (its state is {@link qui.views.STATE_WARNING}).
         * @returns {Boolean}
         */
        hasWarning() {
            return this._state === STATE_WARNING
        }


        /* Error */

        /**
         * Put the view in the error state or updates the error message.
         *
         * The view state is set to {@link qui.views.STATE_ERROR}.
         *
         * It is safe to call this method multiple times, updating the error message.
         *
         * @param {?String|Error} [message] an error message
         */
        setError(message = null) {
            /* No duplicate setError() protection, since we want to be able to update the error */

            if (message instanceof Error) {
                message = message.message
            }

            this._errorMessage = message
            this.setState(STATE_ERROR)
        }

        /**
         * Put the view in the normal state, but only if the current state is {@link qui.views.STATE_ERROR}.
         */
        clearError() {
            if (this._state === STATE_ERROR) {
                this.setState(STATE_NORMAL)
            }
        }

        /**
         * Return the error message set with {@link qui.views.ViewMixin#setError} or `null` if no error message was set.
         *
         * An exception will be thrown if the current view state is not {@link qui.views.STATE_ERROR}.
         *
         * @returns {?String}
         */
        getErrorMessage() {
            if (this._state !== STATE_ERROR) {
                throw new AssertionError(`getErrorMessage() called in ${this._state} state`)
            }

            return this._errorMessage
        }

        /**
         * Define how the view is displayed in error state, showing the error message.
         *
         * {@link qui.views.ViewMixin#hasError} returns `true` when called from this method.
         *
         * By default displays a error toast message. Override this method to implement your own error display.
         *
         * @param {?String} message the error message, or `null` if no error message available
         */
        showError(message) {
            Toast.show({message: message, type: 'error', timeout: 0})
        }

        /**
         * Hide a previously displayed error.
         *
         * {@link qui.views.ViewMixin#hasError} returns `false` when called from this method.
         *
         * By default calls {@link qui.messages.toast.hide}. Override this method to implement your own error
         * hiding.
         */
        hideError() {
            Toast.hide()
        }

        /**
         * Tell if the view is currently in the error state (its state is {@link qui.views.STATE_ERROR}).
         * @returns {Boolean}
         */
        hasError() {
            return this._state === STATE_ERROR
        }


        /* Closing */

        /**
         * Tell if the view has been closed.
         *
         * By default returns `false`.
         *
         * Override this method to implement your own closed status.
         *
         * @returns {Boolean}
         */
        isClosed() {
            return false
        }

        /**
         * Close the view.
         *
         * By default does nothing.
         *
         * Override this method to implement your own close behavior.
         */
        close() {
        }

    }

    return ViewMixin

})


export default ViewMixin
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="qui.html">qui</a></li><li><a href="qui.base.html">base</a></li><li><a href="qui.base.errors.html">errors</a></li><li><a href="qui.base.i18n.html">i18n</a></li><li><a href="qui.base.mixwith.html">mixwith</a></li><li><a href="qui.config.html">config</a></li><li><a href="qui.forms.html">forms</a></li><li><a href="qui.forms.commonfields.html">commonfields</a></li><li><a href="qui.forms.commonforms.html">commonforms</a></li><li><a href="qui.globalglass.html">globalglass</a></li><li><a href="qui.icons.html">icons</a></li><li><a href="qui.icons.defaultstock.html">defaultstock</a></li><li><a href="qui.icons.stocks.html">stocks</a></li><li><a href="qui.lists.html">lists</a></li><li><a href="qui.lists.commonitems.html">commonitems</a></li><li><a href="qui.lists.commonlists.html">commonlists</a></li><li><a href="qui.mainui.html">mainui</a></li><li><a href="qui.mainui.menubar.html">menubar</a></li><li><a href="qui.mainui.optionsbar.html">optionsbar</a></li><li><a href="qui.mainui.status.html">status</a></li><li><a href="qui.mainui.topbar.html">topbar</a></li><li><a href="qui.messages.html">messages</a></li><li><a href="qui.messages.commonmessageforms.html">commonmessageforms</a></li><li><a href="qui.messages.toast.html">toast</a></li><li><a href="qui.navigation.html">navigation</a></li><li><a href="qui.pages.html">pages</a></li><li><a href="qui.pages.commonpages.html">commonpages</a></li><li><a href="qui.pwa.html">pwa</a></li><li><a href="qui.sections.html">sections</a></li><li><a href="qui.tables.html">tables</a></li><li><a href="qui.tables.commoncells.html">commoncells</a></li><li><a href="qui.tables.commontables.html">commontables</a></li><li><a href="qui.theme.html">theme</a></li><li><a href="qui.utils.html">utils</a></li><li><a href="qui.utils.ajax.html">ajax</a></li><li><a href="qui.utils.array.html">array</a></li><li><a href="qui.utils.colors.html">colors</a></li><li><a href="qui.utils.cookies.html">cookies</a></li><li><a href="qui.utils.crypto.html">crypto</a></li><li><a href="qui.utils.css.html">css</a></li><li><a href="qui.utils.date.html">date</a></li><li><a href="qui.utils.files.html">files</a></li><li><a href="qui.utils.gestures.html">gestures</a></li><li><a href="qui.utils.html.html">html</a></li><li><a href="qui.utils.misc.html">misc</a></li><li><a href="qui.utils.object.html">object</a></li><li><a href="qui.utils.promise.html">promise</a></li><li><a href="qui.utils.string.html">string</a></li><li><a href="qui.views.html">views</a></li><li><a href="qui.views.commonviews.html">commonviews</a></li><li><a href="qui.widgets.html">widgets</a></li><li><a href="qui.window.html">window</a></li></ul><h3>Classes</h3><ul><li><a href="qui.base.ConditionVariable.html">ConditionVariable</a></li><li><a href="qui.base.errors.AssertionError.html">AssertionError</a></li><li><a href="qui.base.errors.CancelledError.html">CancelledError</a></li><li><a href="qui.base.errors.NotImplementedError.html">NotImplementedError</a></li><li><a href="qui.base.errors.TimeoutError.html">TimeoutError</a></li><li><a href="qui.base.mixwith.MixinBuilder.html">MixinBuilder</a></li><li><a href="qui.base.Signal.html">Signal</a></li><li><a href="qui.base.Timer.html">Timer</a></li><li><a href="qui.forms.commonfields.CheckField.html">CheckField</a></li><li><a href="qui.forms.commonfields.ChoiceButtonsField.html">ChoiceButtonsField</a></li><li><a href="qui.forms.commonfields.ColorComboField.html">ColorComboField</a></li><li><a href="qui.forms.commonfields.ComboField.html">ComboField</a></li><li><a href="qui.forms.commonfields.CompositeField.html">CompositeField</a></li><li><a href="qui.forms.commonfields.CustomHTMLField.html">CustomHTMLField</a></li><li><a href="qui.forms.commonfields.EmailField.html">EmailField</a></li><li><a href="qui.forms.commonfields.FilePickerField.html">FilePickerField</a></li><li><a href="qui.forms.commonfields.JQueryUIField.html">JQueryUIField</a></li><li><a href="qui.forms.commonfields.LabelsField.html">LabelsField</a></li><li><a href="qui.forms.commonfields.NumericField.html">NumericField</a></li><li><a href="qui.forms.commonfields.PasswordField.html">PasswordField</a></li><li><a href="qui.forms.commonfields.PhoneField.html">PhoneField</a></li><li><a href="qui.forms.commonfields.ProgressDiskField.html">ProgressDiskField</a></li><li><a href="qui.forms.commonfields.PushButtonField.html">PushButtonField</a></li><li><a href="qui.forms.commonfields.SliderField.html">SliderField</a></li><li><a href="qui.forms.commonfields.TextAreaField.html">TextAreaField</a></li><li><a href="qui.forms.commonfields.TextField.html">TextField</a></li><li><a href="qui.forms.commonfields.UpDownField.html">UpDownField</a></li><li><a href="qui.forms.commonforms.OptionsForm.html">OptionsForm</a></li><li><a href="qui.forms.commonforms.PageForm.html">PageForm</a></li><li><a href="qui.forms.ErrorMapping.html">ErrorMapping</a></li><li><a href="qui.forms.Form.html">Form</a></li><li><a href="qui.forms.FormButton.html">FormButton</a></li><li><a href="qui.forms.FormField.html">FormField</a></li><li><a href="qui.forms.ValidationError.html">ValidationError</a></li><li><a href="qui.icons.Icon.html">Icon</a></li><li><a href="qui.icons.MultiStateSpritesIcon.html">MultiStateSpritesIcon</a></li><li><a href="qui.icons.Stock.html">Stock</a></li><li><a href="qui.icons.StockIcon.html">StockIcon</a></li><li><a href="qui.lists.commonitems.IconLabelListItem.html">IconLabelListItem</a></li><li><a href="qui.lists.commonlists.PageList.html">PageList</a></li><li><a href="qui.lists.List.html">List</a></li><li><a href="qui.lists.ListItem.html">ListItem</a></li><li><a href="qui.messages.commonmessageforms.ConfirmMessageForm.html">ConfirmMessageForm</a></li><li><a href="qui.messages.commonmessageforms.SimpleMessageForm.html">SimpleMessageForm</a></li><li><a href="qui.messages.commonmessageforms.StickySimpleMessageForm.html">StickySimpleMessageForm</a></li><li><a href="qui.messages.MessageForm.html">MessageForm</a></li><li><a href="qui.messages.StickyModalProgressMessage.html">StickyModalProgressMessage</a></li><li><a href="qui.navigation.PageLoadError.html">PageLoadError</a></li><li><a href="qui.navigation.PageNotFoundError.html">PageNotFoundError</a></li><li><a href="qui.navigation.SectionLoadError.html">SectionLoadError</a></li><li><a href="qui.pages.commonpages.ModalProgressPage.html">ModalProgressPage</a></li><li><a href="qui.pages.PagesContext.html">PagesContext</a></li><li><a href="qui.sections.HideCancelled.html">HideCancelled</a></li><li><a href="qui.sections.Section.html">Section</a></li><li><a href="qui.tables.commoncells.IconLabelTableCell.html">IconLabelTableCell</a></li><li><a href="qui.tables.commoncells.PushButtonTableCell.html">PushButtonTableCell</a></li><li><a href="qui.tables.commoncells.SimpleTableCell.html">SimpleTableCell</a></li><li><a href="qui.tables.commontables.PageTable.html">PageTable</a></li><li><a href="qui.tables.Table.html">Table</a></li><li><a href="qui.tables.TableCell.html">TableCell</a></li><li><a href="qui.tables.TableRow.html">TableRow</a></li><li><a href="qui.utils.crypto.HMACSHA256.html">HMACSHA256</a></li><li><a href="qui.utils.crypto.SHA256.html">SHA256</a></li><li><a href="qui.utils.URL.html">URL</a></li><li><a href="qui.utils.VisibilityManager.html">VisibilityManager</a></li><li><a href="qui.views.commonviews.IconLabelViewMixin.html">IconLabelViewMixin</a></li></ul><h3>Mixins</h3><ul><li><a href="qui.base.SingletonMixin.html">SingletonMixin</a></li><li><a href="qui.messages.StickyModalPageMixin.html">StickyModalPageMixin</a></li><li><a href="qui.pages.commonpages.StructuredPageMixin.html">StructuredPageMixin</a></li><li><a href="qui.pages.PageMixin.html">PageMixin</a></li><li><a href="qui.views.commonviews.ProgressViewMixin.html">ProgressViewMixin</a></li><li><a href="qui.views.commonviews.StructuredViewMixin.html">StructuredViewMixin</a></li><li><a href="qui.views.ViewMixin.html">ViewMixin</a></li></ul><h3>Global</h3><ul><li><a href="global.html#cleanup">cleanup</a></li><li><a href="global.html#getHTML">getHTML</a></li><li><a href="global.html#getServiceWorker">getServiceWorker</a></li><li><a href="global.html#isClass">isClass</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isServiceWorkerSupported">isServiceWorkerSupported</a></li><li><a href="global.html#makeToken">makeToken</a></li><li><a href="global.html#navigateInitial">navigateInitial</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#sendServiceWorkerMessage">sendServiceWorkerMessage</a></li><li><a href="global.html#serviceWorkerMessageSignal">serviceWorkerMessageSignal</a></li><li><a href="global.html#whenServiceWorkerReady">whenServiceWorkerReady</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Wed Nov 30 2022 21:00:39 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
