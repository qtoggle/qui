<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/css.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/css.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @namespace qui.utils.css
 */

import $ from '$qui/lib/jquery.module.js'

import * as Window from '$qui/window.js'


const CSS_VALUE_RE = new RegExp('([\\d.]+)(.*)')

let customStyleElement = null
let cachedBodyEmPx = null


function getCustomStyleElement() {
    if (!customStyleElement) {
        customStyleElement = createStyleElement()
    }

    return customStyleElement
}


/**
 * Create an empty style element and add it to document head.
 * @alias qui.utils.css.createStyleElement
 * @returns {HTMLStyleElement}
 */
export function createStyleElement() {
    let style = document.createElement('style')
    style.type = 'text/css'
    style.appendChild(document.createTextNode('')) /* Webkit hack */

    let head = document.getElementsByTagName('head')[0]
    head.appendChild(style)

    return style
}

/**
 * Return the link element from the DOM corresponding to a given CSS file.
 * @alias qui.utils.css.getStyleLinkElement
 * @param {String} filename
 * @returns {?HTMLLinkElement}
 */
export function getStyleLinkElement(filename) {
    let links = [...document.getElementsByTagName('link')]
    return links.find(l => l.href.endsWith(filename)) || null
}

/**
 * Create and add a style rule.
 * @alias qui.utils.css.addRule
 * @param {String} selector a CSS selector (e.g. `"div.my-class > div.my-sub-class"`)
 * @param {CSSStyleDeclaration|String} style style declaration (e.g. `"text-align: left; padding: 5px;"`)
 * @param {HTMLStyleElement} [styleElement] an optional style element to add the rule to; by default, rules are added to
 * a common custom style element
 * @returns {Number} the index of the rule within the style element rules list
 */
export function addRule(selector, style, styleElement = null) {
    if (style instanceof window.CSSStyleDeclaration) {
        style = style.cssText
    }

    styleElement = styleElement || getCustomStyleElement()
    return styleElement.sheet.insertRule(`${selector} { ${style} }`, styleElement.sheet.cssRules.length)
}

/**
 * Delete a style rule that matches a given selector.
 * @alias qui.utils.css.delRule
 * @param {String} selector a CSS selector (e.g. `"div.my-class > div.my-sub-class"`)
 * @param {HTMLStyleElement} [styleElement] an optional style element to restrict the search to
 */
export function delRule(selector, styleElement = null) {
    let styleElements

    if (styleElement) {
        styleElements = [styleElement]
    }
    else {
        /* Look through all existing style elements */
        styleElements = [...document.getElementsByTagName('style')]
    }

    styleElements.forEach(function (styleElement) {
        for (let i = 0; i &lt; styleElement.sheet.cssRules.length; i++) {
            let rule = styleElement.sheet.cssRules[i]
            if (rule.selectorText === selector) {
                styleElement.sheet.deleteRule(i--)
            }
        }
    })
}

/**
 * Find all style rules that match a selector regular expression.
 * @alias qui.utils.css.findRules
 * @param {String|RegExp} selectorRe
 * @returns {Object[]} a list of objects with `selector` and `declaration`
 */
export function findRules(selectorRe) {
    if (!(selectorRe instanceof RegExp)) {
        selectorRe = new RegExp(selectorRe)
    }

    let matchedRules = []
    let styleSheets = [...document.styleSheets]
    styleSheets.forEach(function (sheet) {
        if (sheet.disabled) {
            return
        }

        let rules = [...sheet.cssRules]
        let mRules = rules.filter(r => r.selectorText &amp;&amp; r.selectorText.match(selectorRe)).map(function (rule) {
            return rule.selectorText.split(',').map(function (selectorTextPart) {
                selectorTextPart = selectorTextPart.trim()
                if (!selectorTextPart.match(selectorRe)) {
                    return null
                }
                return {
                    selector: selectorTextPart,
                    declaration: rule.cssText.substring(rule.selectorText.length).trim()
                }
            })
        })

        matchedRules = matchedRules.concat(mRules.flat().filter(r => r != null))
    })

    return matchedRules
}

/**
 * Perform an add operation on a CSS value with unit, preserving the unit.
 * @alias qui.utils.css.addValue
 * @param {String} value the CSS value (e.g. `"15px"`)
 * @param {Number|String} operand the number to add
 * @returns {String}
 */
export function addValue(value, operand) {
    let parts = value.toString().match(CSS_VALUE_RE)
    if (!parts) {
        return value
    }

    return parseFloat(parts[1]) + parseFloat(operand) + parts[2]
}

/**
 * Perform a subtract operation on a CSS value with unit, preserving the unit.
 * @alias qui.utils.css.subValue
 * @param {String} value the CSS value (e.g. `"15px"`)
 * @param {Number|String} operand the number to subtract
 * @returns {String}
 */
export function subValue(value, operand) {
    let parts = value.toString().match(CSS_VALUE_RE)
    if (!parts) {
        return value
    }

    return parseFloat(parts[1]) - parseFloat(operand) + parts[2]
}

/**
 * Perform a multiply operation on a CSS value with unit, preserving the unit.
 * @alias qui.utils.css.mulValue
 * @param {String} value the CSS value (e.g. `"15px"`)
 * @param {Number|String} operand the number to multiply by
 * @returns {String}
 */
export function mulValue(value, operand) {
    let parts = value.toString().match(CSS_VALUE_RE)
    if (!parts) {
        return value
    }

    return parseFloat(parts[1]) * parseFloat(operand) + parts[2]
}

/**
 * Perform a divide operation on a CSS value with unit, preserving the unit.
 * @alias qui.utils.css.divValue
 * @param {String} value the CSS value (e.g. `"15px"`)
 * @param {Number|String} operand the number to divide by
 * @returns {String}
 */
export function divValue(value, operand) {
    let parts = value.toString().match(CSS_VALUE_RE)
    if (!parts) {
        return value
    }

    return parseFloat(parts[1]) / parseFloat(operand) + parts[2]
}

/**
 * Convert *em* units to pixel units.
 * @alias qui.utils.css.em2px
 * @param {Number} em
 * @param {jQuery} [elem] optional HTML element; document's body is used by default
 * @returns {Number}
 */
export function em2px(em, elem = Window.$body) {
    if (elem === Window.$body &amp;&amp; cachedBodyEmPx != null) {
        return cachedBodyEmPx * em
    }

    let dummyDiv = $('&lt;div>&lt;/div>', {style: 'width: 1em'})
    elem.append(dummyDiv)

    let clientWidth = dummyDiv[0].clientWidth
    let width = clientWidth * em
    dummyDiv.remove()

    if (elem === Window.$body) {
        cachedBodyEmPx = clientWidth
    }

    return width
}

/**
 * Convert pixel units to *em* units.
 * @alias qui.utils.css.px2em
 * @param {Number} px
 * @param {jQuery} [elem] optional HTML element; document's body is used by default
 * @returns {Number}
 */
export function px2em(px, elem = Window.$body) {
    let dummyDiv = $('&lt;div style="width: 1em">&lt;/div>')
    elem.append(dummyDiv)

    let width = px / dummyDiv.width()
    dummyDiv.remove()

    return width
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="qui.html">qui</a></li><li><a href="qui.base.html">base</a></li><li><a href="qui.base.errors.html">errors</a></li><li><a href="qui.base.i18n.html">i18n</a></li><li><a href="qui.base.mixwith.html">mixwith</a></li><li><a href="qui.config.html">config</a></li><li><a href="qui.forms.html">forms</a></li><li><a href="qui.forms.commonfields.html">commonfields</a></li><li><a href="qui.forms.commonforms.html">commonforms</a></li><li><a href="qui.globalglass.html">globalglass</a></li><li><a href="qui.icons.html">icons</a></li><li><a href="qui.icons.defaultstock.html">defaultstock</a></li><li><a href="qui.icons.stocks.html">stocks</a></li><li><a href="qui.lists.html">lists</a></li><li><a href="qui.lists.commonitems.html">commonitems</a></li><li><a href="qui.lists.commonlists.html">commonlists</a></li><li><a href="qui.mainui.html">mainui</a></li><li><a href="qui.mainui.menubar.html">menubar</a></li><li><a href="qui.mainui.optionsbar.html">optionsbar</a></li><li><a href="qui.mainui.status.html">status</a></li><li><a href="qui.mainui.topbar.html">topbar</a></li><li><a href="qui.messages.html">messages</a></li><li><a href="qui.messages.commonmessageforms.html">commonmessageforms</a></li><li><a href="qui.messages.toast.html">toast</a></li><li><a href="qui.navigation.html">navigation</a></li><li><a href="qui.pages.html">pages</a></li><li><a href="qui.pages.commonpages.html">commonpages</a></li><li><a href="qui.pwa.html">pwa</a></li><li><a href="qui.sections.html">sections</a></li><li><a href="qui.tables.html">tables</a></li><li><a href="qui.tables.commoncells.html">commoncells</a></li><li><a href="qui.tables.commontables.html">commontables</a></li><li><a href="qui.theme.html">theme</a></li><li><a href="qui.utils.html">utils</a></li><li><a href="qui.utils.ajax.html">ajax</a></li><li><a href="qui.utils.array.html">array</a></li><li><a href="qui.utils.colors.html">colors</a></li><li><a href="qui.utils.cookies.html">cookies</a></li><li><a href="qui.utils.crypto.html">crypto</a></li><li><a href="qui.utils.css.html">css</a></li><li><a href="qui.utils.date.html">date</a></li><li><a href="qui.utils.files.html">files</a></li><li><a href="qui.utils.gestures.html">gestures</a></li><li><a href="qui.utils.html.html">html</a></li><li><a href="qui.utils.misc.html">misc</a></li><li><a href="qui.utils.object.html">object</a></li><li><a href="qui.utils.promise.html">promise</a></li><li><a href="qui.utils.string.html">string</a></li><li><a href="qui.views.html">views</a></li><li><a href="qui.views.commonviews.html">commonviews</a></li><li><a href="qui.widgets.html">widgets</a></li><li><a href="qui.window.html">window</a></li></ul><h3>Classes</h3><ul><li><a href="qui.base.ConditionVariable.html">ConditionVariable</a></li><li><a href="qui.base.errors.AssertionError.html">AssertionError</a></li><li><a href="qui.base.errors.CancelledError.html">CancelledError</a></li><li><a href="qui.base.errors.NotImplementedError.html">NotImplementedError</a></li><li><a href="qui.base.errors.TimeoutError.html">TimeoutError</a></li><li><a href="qui.base.mixwith.MixinBuilder.html">MixinBuilder</a></li><li><a href="qui.base.Signal.html">Signal</a></li><li><a href="qui.base.Timer.html">Timer</a></li><li><a href="qui.forms.commonfields.CheckField.html">CheckField</a></li><li><a href="qui.forms.commonfields.ChoiceButtonsField.html">ChoiceButtonsField</a></li><li><a href="qui.forms.commonfields.ColorComboField.html">ColorComboField</a></li><li><a href="qui.forms.commonfields.ComboField.html">ComboField</a></li><li><a href="qui.forms.commonfields.CompositeField.html">CompositeField</a></li><li><a href="qui.forms.commonfields.CustomHTMLField.html">CustomHTMLField</a></li><li><a href="qui.forms.commonfields.EmailField.html">EmailField</a></li><li><a href="qui.forms.commonfields.FilePickerField.html">FilePickerField</a></li><li><a href="qui.forms.commonfields.JQueryUIField.html">JQueryUIField</a></li><li><a href="qui.forms.commonfields.LabelsField.html">LabelsField</a></li><li><a href="qui.forms.commonfields.NumericField.html">NumericField</a></li><li><a href="qui.forms.commonfields.PasswordField.html">PasswordField</a></li><li><a href="qui.forms.commonfields.PhoneField.html">PhoneField</a></li><li><a href="qui.forms.commonfields.ProgressDiskField.html">ProgressDiskField</a></li><li><a href="qui.forms.commonfields.PushButtonField.html">PushButtonField</a></li><li><a href="qui.forms.commonfields.SliderField.html">SliderField</a></li><li><a href="qui.forms.commonfields.TextAreaField.html">TextAreaField</a></li><li><a href="qui.forms.commonfields.TextField.html">TextField</a></li><li><a href="qui.forms.commonfields.UpDownField.html">UpDownField</a></li><li><a href="qui.forms.commonforms.OptionsForm.html">OptionsForm</a></li><li><a href="qui.forms.commonforms.PageForm.html">PageForm</a></li><li><a href="qui.forms.ErrorMapping.html">ErrorMapping</a></li><li><a href="qui.forms.Form.html">Form</a></li><li><a href="qui.forms.FormButton.html">FormButton</a></li><li><a href="qui.forms.FormField.html">FormField</a></li><li><a href="qui.forms.ValidationError.html">ValidationError</a></li><li><a href="qui.icons.Icon.html">Icon</a></li><li><a href="qui.icons.MultiStateSpritesIcon.html">MultiStateSpritesIcon</a></li><li><a href="qui.icons.Stock.html">Stock</a></li><li><a href="qui.icons.StockIcon.html">StockIcon</a></li><li><a href="qui.lists.commonitems.IconLabelListItem.html">IconLabelListItem</a></li><li><a href="qui.lists.commonlists.PageList.html">PageList</a></li><li><a href="qui.lists.List.html">List</a></li><li><a href="qui.lists.ListItem.html">ListItem</a></li><li><a href="qui.messages.commonmessageforms.ConfirmMessageForm.html">ConfirmMessageForm</a></li><li><a href="qui.messages.commonmessageforms.SimpleMessageForm.html">SimpleMessageForm</a></li><li><a href="qui.messages.commonmessageforms.StickySimpleMessageForm.html">StickySimpleMessageForm</a></li><li><a href="qui.messages.MessageForm.html">MessageForm</a></li><li><a href="qui.messages.StickyModalProgressMessage.html">StickyModalProgressMessage</a></li><li><a href="qui.navigation.PageLoadError.html">PageLoadError</a></li><li><a href="qui.navigation.PageNotFoundError.html">PageNotFoundError</a></li><li><a href="qui.navigation.SectionLoadError.html">SectionLoadError</a></li><li><a href="qui.pages.commonpages.ModalProgressPage.html">ModalProgressPage</a></li><li><a href="qui.pages.PagesContext.html">PagesContext</a></li><li><a href="qui.sections.HideCancelled.html">HideCancelled</a></li><li><a href="qui.sections.Section.html">Section</a></li><li><a href="qui.tables.commoncells.IconLabelTableCell.html">IconLabelTableCell</a></li><li><a href="qui.tables.commoncells.PushButtonTableCell.html">PushButtonTableCell</a></li><li><a href="qui.tables.commoncells.SimpleTableCell.html">SimpleTableCell</a></li><li><a href="qui.tables.commontables.PageTable.html">PageTable</a></li><li><a href="qui.tables.Table.html">Table</a></li><li><a href="qui.tables.TableCell.html">TableCell</a></li><li><a href="qui.tables.TableRow.html">TableRow</a></li><li><a href="qui.utils.crypto.HMACSHA256.html">HMACSHA256</a></li><li><a href="qui.utils.crypto.SHA256.html">SHA256</a></li><li><a href="qui.utils.URL.html">URL</a></li><li><a href="qui.utils.VisibilityManager.html">VisibilityManager</a></li><li><a href="qui.views.commonviews.IconLabelViewMixin.html">IconLabelViewMixin</a></li></ul><h3>Mixins</h3><ul><li><a href="qui.base.SingletonMixin.html">SingletonMixin</a></li><li><a href="qui.messages.StickyModalPageMixin.html">StickyModalPageMixin</a></li><li><a href="qui.pages.commonpages.StructuredPageMixin.html">StructuredPageMixin</a></li><li><a href="qui.pages.PageMixin.html">PageMixin</a></li><li><a href="qui.views.commonviews.ProgressViewMixin.html">ProgressViewMixin</a></li><li><a href="qui.views.commonviews.StructuredViewMixin.html">StructuredViewMixin</a></li><li><a href="qui.views.ViewMixin.html">ViewMixin</a></li></ul><h3>Global</h3><ul><li><a href="global.html#cleanup">cleanup</a></li><li><a href="global.html#getHTML">getHTML</a></li><li><a href="global.html#getServiceWorker">getServiceWorker</a></li><li><a href="global.html#isClass">isClass</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isServiceWorkerSupported">isServiceWorkerSupported</a></li><li><a href="global.html#makeToken">makeToken</a></li><li><a href="global.html#navigateInitial">navigateInitial</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#sendServiceWorkerMessage">sendServiceWorkerMessage</a></li><li><a href="global.html#serviceWorkerMessageSignal">serviceWorkerMessageSignal</a></li><li><a href="global.html#whenServiceWorkerReady">whenServiceWorkerReady</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Fri Nov 07 2025 19:14:40 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
